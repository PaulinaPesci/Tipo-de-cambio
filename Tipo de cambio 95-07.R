# Paquetes ====
install.packages("Metrics")
install.packages("forecast")
install.packages("tseries")

library(Metrics)
library(haven)
library(astsa)
library(tseries)
library(readxl)
library(zoo)
library(lmtest)
library(ggplot2)
library(forecast)

tipo_de_cambio <- read_excel("Data/Raw/T. Cambio Mensual FIX.xlsx")
View(tipo_de_cambio)

# Transformamos los datos de tipo de cambio en una serie temporal
tdc <- ts(tipo_de_cambio$FIX, start = c(1995,1), frequency = 12)
print(tdc)
length(tdc)
plot.ts(tdc, main = "Tipo de cambio")
tdcplot <- tdc[1:162]
tdcplotts <- ts(tdcplot, start = c(1995,1), frequency = 12)
tdcs <- tdc[1:156]
tdcts <- ts(tdcs, start = c(1995,1), frequency = 12)
print(tdcts)
length(tdcts)


acf(tdcts, length(tdcts)^.5, na.action = na.pass)
pacf(tdcts, length(tdcts)^.5, na.action = na.pass)

Box.test(tdcts, lag = length(tdcts)^.5, type = c("Box-Pierce"))
Box.test(tdcts, lag = length(tdcts)^.5, type = c("Ljung-Box"))

# Tendencia ====
time <- (1:156)
time2 <- time^2

## Regresión lineal ====
reg_lineal <- lm(tdcts ~ time, data = tdcts)
summary.lm(reg_lineal, reg = TRUE)

### Residuales ====
resid_lineal <- residuals(reg_lineal)
plot.ts(resid_lineal, type = "l", main = "Residuales regresión lineal")
trend_lineal <- fitted.values(reg_lineal)
ts.plot(tdcts, trend_lineal, gpars = list(col = c("black", "blue"), main = "Regresión lineal"))

## Regresión cuadrática ====
reg_cuad <- lm(tdcts ~ time + time2, data = tdcts)
summary.lm(reg_cuad, reg = TRUE)

### Residuales ====
resid_cuad <- residuals(reg_cuad)
plot.ts(resid_cuad, type = "l", main = "Residuales regresión cuadrática")
trend_cuad <- fitted.values(reg_cuad)
ts.plot(tdcts, trend_cuad, gpars = list(col = c("black", "blue"), main = "Regresión cuadrática"))

## Regresión exponencial ====
ln_tdcst <- log(tdcts)
reg_aux <- lm(ln_tdcst ~ time, data = ln_tdcst)
summary(reg_aux)
b0 <- exp(1.9922121)
b1 <-  0.0032236

reg_exp <- nls(tdcts ~ a*exp(b*time), start = list(a = b0, b = b1))
summary(reg_exp)

### Residuales ====
resid_exp <- residuals(reg_exp)
plot.ts(resid_exp, type = "l", main = "Residuales regresión exponencial")
trend_exp <- fitted.values(reg_exp)
ts.plot(tdcts, trend_exp, gpars = list(col = c("black", "blue"), main = "Regresión exponencial"))

## Pruebas ====
BIC(reg_lineal)
BIC(reg_cuad)
BIC(reg_exp)

AIC(reg_lineal)
AIC(reg_cuad)
AIC(reg_exp)

# gana la cuadrática por ambos criterios de selección

# Estacionalidad ====
dummies_mensuales <- read_excel("Data/Raw/Dummies/dummies mensuales 95-07.xlsx")
View(dummies_mensuales)

d1 <- ts(dummies_mensuales$d1, start = c(1995,1), frequency = 12)
d2 <- ts(dummies_mensuales$d2, start = c(1995,1), frequency = 12)
d3 <- ts(dummies_mensuales$d3, start = c(1995,1), frequency = 12)
d4 <- ts(dummies_mensuales$d4, start = c(1995,1), frequency = 12)         
d5 <- ts(dummies_mensuales$d5, start = c(1995,1), frequency = 12)
d6 <- ts(dummies_mensuales$d6, start = c(1995,1), frequency = 12)
d7 <- ts(dummies_mensuales$d7, start = c(1995,1), frequency = 12)
d8 <- ts(dummies_mensuales$d8, start = c(1995,1), frequency = 12)
d9 <- ts(dummies_mensuales$d9, start = c(1995,1), frequency = 12)
d10 <- ts(dummies_mensuales$d10, start = c(1995,1), frequency = 12)
d11 <- ts(dummies_mensuales$d11, start = c(1995,1), frequency = 12)
d12 <- ts(dummies_mensuales$d12, start = c(1995,1), frequency = 12)

data_tdc <- ts.intersect(tdcts, time, time2, d1, d2, d3, d4, d5, d6, d7, d8, d9, d10, d11, d12)

reg_tdc <- lm(tdcts ~ time + time2 + d2 + d3 + d4 + d5 + d6 + d7 + d8 + d9 + d10 + d11 + d12, data = data_tdc)
summary.lm(reg_tdc, robust = TRUE)

## Prueba de Wald ====
waldtest(reg_tdc, reg_cuad)

# No hay estacionalidad entonces me quedo con los residuales de la reg_cuad

# Residuales ====
summary.lm(reg_cuad, robust = TRUE)
plot.ts(resid_cuad, type = "l", main = "Residuales regresión cuadrática")

acf(resid_cuad, length(resid_cuad)^.5, na.action = na.pass)
pacf(resid_cuad,length(resid_cuad)^.5, na.action = na.pass)
Box.test(resid_cuad, lag = length(resid_cuad)^.5, type = c("Box-Pierce"))
Box.test(resid_cuad, lag = length(resid_cuad)^.5, type = c("Ljung-Box"))

# Modelos ====
# Arima (p, 0, q)

## Modelos AR ====
ar1 <- arima(resid_cuad, order = c(1,0,0), n.cond = 14)
ar2 <- arima(resid_cuad, order = c(2,0,0), n.cond = 14)
ar3 <- arima(resid_cuad, order = c(3,0,0), n.cond = 14)
ar4 <- arima(resid_cuad, order = c(4,0,0), n.cond = 14)
ar5 <- arima(resid_cuad, order = c(5,0,0), n.cond = 14)
ar6 <- arima(resid_cuad, order = c(6,0,0), n.cond = 14)
ar7 <- arima(resid_cuad, order = c(7,0,0), n.cond = 14)
ar8 <- arima(resid_cuad, order = c(8,0,0), n.cond = 14)
ar9 <- arima(resid_cuad, order = c(9,0,0), n.cond = 14)
ar10 <- arima(resid_cuad, order = c(10,0,0), n.cond = 14)
ar11 <- arima(resid_cuad, order = c(11,0,0), n.cond = 14)
ar12 <- arima(resid_cuad, order = c(12,0,0), n.cond = 14)
ar13 <- arima(resid_cuad, order = c(13,0,0), n.cond = 14)
ar14 <- arima(resid_cuad, order = c(14,0,0), n.cond = 14)

## Modelos MA ====

ma1 <- arima(resid_cuad, order = c(0,0,1), n.cond = 14)
ma2 <- arima(resid_cuad, order = c(0,0,2), n.cond = 14)
ma3 <- arima(resid_cuad, order = c(0,0,3), n.cond = 14)
ma4 <- arima(resid_cuad, order = c(0,0,4), n.cond = 14)
ma5 <- arima(resid_cuad, order = c(0,0,5), n.cond = 14)
ma6 <- arima(resid_cuad, order = c(0,0,6), n.cond = 14)
ma7 <- arima(resid_cuad, order = c(0,0,7), n.cond = 14)
ma8 <- arima(resid_cuad, order = c(0,0,8), n.cond = 14)
ma9 <- arima(resid_cuad, order = c(0,0,9), n.cond = 14)
ma10 <- arima(resid_cuad, order = c(0,0,10), n.cond = 14)
ma11 <- arima(resid_cuad, order = c(0,0,11), n.cond = 14)
ma12 <- arima(resid_cuad, order = c(0,0,12), n.cond = 14)
ma13 <- arima(resid_cuad, order = c(0,0,13), n.cond = 14)
ma14 <- arima(resid_cuad, order = c(0,0,14), n.cond = 14)

## Modelos ARMA ====

arma101 <- arima(resid_cuad, order = c(1,0,1), n.cond = 14)
arma102 <- arima(resid_cuad, order = c(1,0,2), n.cond = 14)
arma103 <- arima(resid_cuad, order = c(1,0,3), n.cond = 14)
arma104 <- arima(resid_cuad, order = c(1,0,4), n.cond = 14)
arma105 <- arima(resid_cuad, order = c(1,0,5), n.cond = 14)
arma106 <- arima(resid_cuad, order = c(1,0,6), n.cond = 14)
arma107 <- arima(resid_cuad, order = c(1,0,7), n.cond = 14)
arma108 <- arima(resid_cuad, order = c(1,0,8), n.cond = 14)
arma109 <- arima(resid_cuad, order = c(1,0,9), n.cond = 14)
arma1010 <- arima(resid_cuad, order = c(1,0,10), n.cond = 14)
arma1011 <- arima(resid_cuad, order = c(1,0,11), n.cond = 14)
arma1012 <- arima(resid_cuad, order = c(1,0,12), n.cond = 14)
arma1013 <- arima(resid_cuad, order = c(1,0,13), n.cond = 14)
arma1014 <- arima(resid_cuad, order = c(1,0,14), n.cond = 14)

arma201 <- arima(resid_cuad, order = c(2,0,1), n.cond = 14)
arma202 <- arima(resid_cuad, order = c(2,0,2), n.cond = 14)
arma203 <- arima(resid_cuad, order = c(2,0,3), n.cond = 14)
arma204 <- arima(resid_cuad, order = c(2,0,4), n.cond = 14)
arma205 <- arima(resid_cuad, order = c(2,0,5), n.cond = 14)
arma206 <- arima(resid_cuad, order = c(2,0,6), n.cond = 14)
arma207 <- arima(resid_cuad, order = c(2,0,7), n.cond = 14)
arma208 <- arima(resid_cuad, order = c(2,0,8), n.cond = 14)
arma209 <- arima(resid_cuad, order = c(2,0,9), n.cond = 14)
arma2010 <- arima(resid_cuad, order = c(2,0,10), n.cond = 14)
arma2011 <- arima(resid_cuad, order = c(2,0,11), n.cond = 14)
arma2012 <- arima(resid_cuad, order = c(2,0,12), n.cond = 14)
arma2013 <- arima(resid_cuad, order = c(2,0,13), n.cond = 14)
arma2014 <- arima(resid_cuad, order = c(2,0,14), n.cond = 14)

arma301 <- arima(resid_cuad, order = c(3,0,1), n.cond = 14)
arma302 <- arima(resid_cuad, order = c(3,0,2), n.cond = 14)
arma303 <- arima(resid_cuad, order = c(3,0,3), n.cond = 14)
arma304 <- arima(resid_cuad, order = c(3,0,4), n.cond = 14)
arma305 <- arima(resid_cuad, order = c(3,0,5), n.cond = 14)
arma306 <- arima(resid_cuad, order = c(3,0,6), n.cond = 14)
arma307 <- arima(resid_cuad, order = c(3,0,7), n.cond = 14)
arma308 <- arima(resid_cuad, order = c(3,0,8), n.cond = 14)
arma309 <- arima(resid_cuad, order = c(3,0,9), n.cond = 14)
arma3010 <- arima(resid_cuad, order = c(3,0,10), n.cond = 14)
arma3011 <- arima(resid_cuad, order = c(3,0,11), n.cond = 14)
arma3012 <- arima(resid_cuad, order = c(3,0,12), n.cond = 14)
arma3013 <- arima(resid_cuad, order = c(3,0,13), n.cond = 14)
arma3014 <- arima(resid_cuad, order = c(3,0,14), n.cond = 14)

arma401 <- arima(resid_cuad, order = c(4,0,1), n.cond = 14)
arma402 <- arima(resid_cuad, order = c(4,0,2), n.cond = 14)
arma403 <- arima(resid_cuad, order = c(4,0,3), n.cond = 14)
arma404 <- arima(resid_cuad, order = c(4,0,4), n.cond = 14)
arma405 <- arima(resid_cuad, order = c(4,0,5), n.cond = 14)
arma406 <- arima(resid_cuad, order = c(4,0,6), n.cond = 14)
arma407 <- arima(resid_cuad, order = c(4,0,7), n.cond = 14)
arma408 <- arima(resid_cuad, order = c(4,0,8), n.cond = 14)
arma409 <- arima(resid_cuad, order = c(4,0,9), n.cond = 14)
arma4010 <- arima(resid_cuad, order = c(4,0,10), n.cond = 14)
arma4011 <- arima(resid_cuad, order = c(4,0,11), n.cond = 14)
arma4012 <- arima(resid_cuad, order = c(4,0,12), n.cond = 14)
arma4013 <- arima(resid_cuad, order = c(4,0,13), n.cond = 14)
arma4014 <- arima(resid_cuad, order = c(4,0,14), n.cond = 14)

arma501 <- arima(resid_cuad, order = c(5,0,1), n.cond = 14)
arma502 <- arima(resid_cuad, order = c(5,0,2), n.cond = 14)
arma503 <- arima(resid_cuad, order = c(5,0,3), n.cond = 14)
arma504 <- arima(resid_cuad, order = c(5,0,4), n.cond = 14)
arma505 <- arima(resid_cuad, order = c(5,0,5), n.cond = 14)
arma506 <- arima(resid_cuad, order = c(5,0,6), n.cond = 14)
arma507 <- arima(resid_cuad, order = c(5,0,7), n.cond = 14)
arma508 <- arima(resid_cuad, order = c(5,0,8), n.cond = 14)
arma509 <- arima(resid_cuad, order = c(5,0,9), n.cond = 14)
arma5010 <- arima(resid_cuad, order = c(5,0,10), n.cond = 14)
arma5011 <- arima(resid_cuad, order = c(5,0,11), n.cond = 14)
arma5012 <- arima(resid_cuad, order = c(5,0,12), n.cond = 14)
arma5013 <- arima(resid_cuad, order = c(5,0,13), n.cond = 14)
arma5014 <- arima(resid_cuad, order = c(5,0,14), n.cond = 14)

arma601 <- arima(resid_cuad, order = c(6,0,1), n.cond = 14)
arma602 <- arima(resid_cuad, order = c(6,0,2), n.cond = 14)
arma603 <- arima(resid_cuad, order = c(6,0,3), n.cond = 14)
arma604 <- arima(resid_cuad, order = c(6,0,4), n.cond = 14)
arma605 <- arima(resid_cuad, order = c(6,0,5), n.cond = 14)
arma606 <- arima(resid_cuad, order = c(6,0,6), n.cond = 14)
arma607 <- arima(resid_cuad, order = c(6,0,7), n.cond = 14)
arma608 <- arima(resid_cuad, order = c(6,0,8), n.cond = 14)
arma609 <- arima(resid_cuad, order = c(6,0,9), n.cond = 14)
arma6010 <- arima(resid_cuad, order = c(6,0,10), n.cond = 14)
arma6011 <- arima(resid_cuad, order = c(6,0,11), n.cond = 14)
arma6012 <- arima(resid_cuad, order = c(6,0,12), n.cond = 14)
arma6013 <- arima(resid_cuad, order = c(6,0,13), n.cond = 14)
arma6014 <- arima(resid_cuad, order = c(6,0,14), n.cond = 14)

arma701 <- arima(resid_cuad, order = c(7,0,1), n.cond = 14)
arma702 <- arima(resid_cuad, order = c(7,0,2), n.cond = 14)
arma703 <- arima(resid_cuad, order = c(7,0,3), n.cond = 14)
arma704 <- arima(resid_cuad, order = c(7,0,4), n.cond = 14)
arma705 <- arima(resid_cuad, order = c(7,0,5), n.cond = 14)
arma706 <- arima(resid_cuad, order = c(7,0,6), n.cond = 14)
arma707 <- arima(resid_cuad, order = c(7,0,7), n.cond = 14)
arma708 <- arima(resid_cuad, order = c(7,0,8), n.cond = 14)
arma709 <- arima(resid_cuad, order = c(7,0,9), n.cond = 14)
arma7010 <- arima(resid_cuad, order = c(7,0,10), n.cond = 14)
arma7011 <- arima(resid_cuad, order = c(7,0,11), n.cond = 14)
arma7012 <- arima(resid_cuad, order = c(7,0,12), n.cond = 14)
arma7013 <- arima(resid_cuad, order = c(7,0,13), n.cond = 14)
arma7014 <- arima(resid_cuad, order = c(7,0,14), n.cond = 14)

arma801 <- arima(resid_cuad, order = c(8,0,1), n.cond = 14)
arma802 <- arima(resid_cuad, order = c(8,0,2), n.cond = 14)
arma803 <- arima(resid_cuad, order = c(8,0,3), n.cond = 14)
arma804 <- arima(resid_cuad, order = c(8,0,4), n.cond = 14)
arma805 <- arima(resid_cuad, order = c(8,0,5), n.cond = 14)
arma806 <- arima(resid_cuad, order = c(8,0,6), n.cond = 14)
arma807 <- arima(resid_cuad, order = c(8,0,7), n.cond = 14)
arma808 <- arima(resid_cuad, order = c(8,0,8), n.cond = 14)
arma809 <- arima(resid_cuad, order = c(8,0,9), n.cond = 14)
arma8010 <- arima(resid_cuad, order = c(8,0,10), n.cond = 14)
arma8011 <- arima(resid_cuad, order = c(8,0,11), n.cond = 14)
arma8012 <- arima(resid_cuad, order = c(8,0,12), n.cond = 14)
arma8013 <- arima(resid_cuad, order = c(8,0,13), n.cond = 14)
arma8014 <- arima(resid_cuad, order = c(8,0,14), n.cond = 14)

arma901 <- arima(resid_cuad, order = c(9,0,1), n.cond = 14)
arma902 <- arima(resid_cuad, order = c(9,0,2), n.cond = 14)
arma903 <- arima(resid_cuad, order = c(9,0,3), n.cond = 14)
arma904 <- arima(resid_cuad, order = c(9,0,4), n.cond = 14)
arma905 <- arima(resid_cuad, order = c(9,0,5), n.cond = 14)
arma906 <- arima(resid_cuad, order = c(9,0,6), n.cond = 14)
arma907 <- arima(resid_cuad, order = c(9,0,7), n.cond = 14)
arma908 <- arima(resid_cuad, order = c(9,0,8), n.cond = 14)
arma909 <- arima(resid_cuad, order = c(9,0,9), n.cond = 14)
arma9010 <- arima(resid_cuad, order = c(9,0,10), n.cond = 14)
arma9011 <- arima(resid_cuad, order = c(9,0,11), n.cond = 14)
arma9012 <- arima(resid_cuad, order = c(9,0,12), n.cond = 14)
arma9013 <- arima(resid_cuad, order = c(9,0,13), n.cond = 14)
arma9014 <- arima(resid_cuad, order = c(9,0,14), n.cond = 14)

arma1001 <- arima(resid_cuad, order = c(10,0,1), n.cond = 14)
arma1002 <- arima(resid_cuad, order = c(10,0,2), n.cond = 14)
arma1003 <- arima(resid_cuad, order = c(10,0,3), n.cond = 14)
arma1004 <- arima(resid_cuad, order = c(10,0,4), n.cond = 14)
arma1005 <- arima(resid_cuad, order = c(10,0,5), n.cond = 14)
arma1006 <- arima(resid_cuad, order = c(10,0,6), n.cond = 14)
arma1007 <- arima(resid_cuad, order = c(10,0,7), n.cond = 14)
arma1008 <- arima(resid_cuad, order = c(10,0,8), n.cond = 14)
arma1009 <- arima(resid_cuad, order = c(10,0,9), n.cond = 14)
arma10010 <- arima(resid_cuad, order = c(10,0,10), n.cond = 14)
arma10011 <- arima(resid_cuad, order = c(10,0,11), n.cond = 14)
arma10012 <- arima(resid_cuad, order = c(10,0,12), n.cond = 14)
arma10013 <- arima(resid_cuad, order = c(10,0,13), n.cond = 14)
arma10014 <- arima(resid_cuad, order = c(10,0,14), n.cond = 14)

arma1101 <- arima(resid_cuad, order = c(11,0,1), n.cond = 14)
arma1102 <- arima(resid_cuad, order = c(11,0,2), n.cond = 14)
arma1103 <- arima(resid_cuad, order = c(11,0,3), n.cond = 14)
arma1104 <- arima(resid_cuad, order = c(11,0,4), n.cond = 14)
arma1105 <- arima(resid_cuad, order = c(11,0,5), n.cond = 14)
arma1106 <- arima(resid_cuad, order = c(11,0,6), n.cond = 14)
arma1107 <- arima(resid_cuad, order = c(11,0,7), n.cond = 14)
arma1108 <- arima(resid_cuad, order = c(11,0,8), n.cond = 14)
arma1109 <- arima(resid_cuad, order = c(11,0,9), n.cond = 14)
arma11010 <- arima(resid_cuad, order = c(11,0,10), n.cond = 14)
arma11011 <- arima(resid_cuad, order = c(11,0,11), n.cond = 14)
arma11012 <- arima(resid_cuad, order = c(11,0,12), n.cond = 14)
arma11013 <- arima(resid_cuad, order = c(11,0,13), n.cond = 14)
arma11014 <- arima(resid_cuad, order = c(11,0,14), n.cond = 14)

arma1201 <- arima(resid_cuad, order = c(12,0,1), n.cond = 14)
arma1202 <- arima(resid_cuad, order = c(12,0,2), n.cond = 14)
arma1203 <- arima(resid_cuad, order = c(12,0,3), n.cond = 14)
arma1204 <- arima(resid_cuad, order = c(12,0,4), n.cond = 14)
arma1205 <- arima(resid_cuad, order = c(12,0,5), n.cond = 14)
arma1206 <- arima(resid_cuad, order = c(12,0,6), n.cond = 14)
arma1207 <- arima(resid_cuad, order = c(12,0,7), n.cond = 14)
arma1208 <- arima(resid_cuad, order = c(12,0,8), n.cond = 14)
arma1209 <- arima(resid_cuad, order = c(12,0,9), n.cond = 14)
arma12010 <- arima(resid_cuad, order = c(12,0,10), n.cond = 14)
arma12011 <- arima(resid_cuad, order = c(12,0,11), n.cond = 14)
arma12012 <- arima(resid_cuad, order = c(12,0,12), n.cond = 14)
arma12013 <- arima(resid_cuad, order = c(12,0,13), n.cond = 14)
arma12014 <- arima(resid_cuad, order = c(12,0,14), n.cond = 14)

arma1301 <- arima(resid_cuad, order = c(13,0,1), n.cond = 14)
arma1302 <- arima(resid_cuad, order = c(13,0,2), n.cond = 14)
arma1303 <- arima(resid_cuad, order = c(13,0,3), n.cond = 14)
arma1304 <- arima(resid_cuad, order = c(13,0,4), n.cond = 14)
arma1305 <- arima(resid_cuad, order = c(13,0,5), n.cond = 14)
arma1306 <- arima(resid_cuad, order = c(13,0,6), n.cond = 14)
arma1307 <- arima(resid_cuad, order = c(13,0,7), n.cond = 14)
arma1308 <- arima(resid_cuad, order = c(13,0,8), n.cond = 14)
arma1309 <- arima(resid_cuad, order = c(13,0,9), n.cond = 14)
arma13010 <- arima(resid_cuad, order = c(13,0,10), n.cond = 14)
arma13011 <- arima(resid_cuad, order = c(13,0,11), n.cond = 14)
arma13012 <- arima(resid_cuad, order = c(13,0,12), n.cond = 14)
arma13013 <- arima(resid_cuad, order = c(13,0,13), n.cond = 14)
arma13014 <- arima(resid_cuad, order = c(13,0,14), n.cond = 14)

arma1401 <- arima(resid_cuad, order = c(14,0,1), n.cond = 14)
arma1402 <- arima(resid_cuad, order = c(14,0,2), n.cond = 14)
arma1403 <- arima(resid_cuad, order = c(14,0,3), n.cond = 14)
arma1404 <- arima(resid_cuad, order = c(14,0,4), n.cond = 14)
arma1405 <- arima(resid_cuad, order = c(14,0,5), n.cond = 14)
arma1406 <- arima(resid_cuad, order = c(14,0,6), n.cond = 14)
arma1407 <- arima(resid_cuad, order = c(14,0,7), n.cond = 14)
arma1408 <- arima(resid_cuad, order = c(14,0,8), n.cond = 14)
arma1409 <- arima(resid_cuad, order = c(14,0,9), n.cond = 14)
arma14010 <- arima(resid_cuad, order = c(14,0,10), n.cond = 14)
arma14011 <- arima(resid_cuad, order = c(14,0,11), n.cond = 14)
arma14012 <- arima(resid_cuad, order = c(14,0,12), n.cond = 14)
arma14013 <- arima(resid_cuad, order = c(14,0,13), n.cond = 14)
arma14014 <- arima(resid_cuad, order = c(14,0,14), n.cond = 14)

## Prueba BIC ====

BIC(ar1)
BIC(ar2)
BIC(ar3)
BIC(ar4)
BIC(ar5)
BIC(ar6)
BIC(ar7)
BIC(ar8)
BIC(ar9)
BIC(ar10)
BIC(ar11)
BIC(ar12)
BIC(ar13)
BIC(ar14)

BIC(ma1)
BIC(ma2)
BIC(ma3)
BIC(ma4)
BIC(ma5)
BIC(ma6)
BIC(ma7)
BIC(ma8)
BIC(ma9)
BIC(ma10)
BIC(ma11)
BIC(ma12)
BIC(ma13)
BIC(ma14)

BIC(arma101)
BIC(arma102)
BIC(arma103)
BIC(arma104)
BIC(arma105)
BIC(arma106)
BIC(arma107)
BIC(arma108)
BIC(arma109)
BIC(arma1010)
BIC(arma1011)
BIC(arma1012)
BIC(arma1013)
BIC(arma1014)

BIC(arma201)
BIC(arma202)
BIC(arma203)
BIC(arma204)
BIC(arma205)
BIC(arma206)
BIC(arma207)
BIC(arma208)
BIC(arma209)
BIC(arma2010)
BIC(arma2011)
BIC(arma2012)
BIC(arma2013)
BIC(arma2014)

BIC(arma301)
BIC(arma302)
BIC(arma303)
BIC(arma304)
BIC(arma305)
BIC(arma306)
BIC(arma307)
BIC(arma308)
BIC(arma309)
BIC(arma3010)
BIC(arma3011)
BIC(arma3012)
BIC(arma3013)
BIC(arma3014)

BIC(arma401)
BIC(arma402)
BIC(arma403)
BIC(arma404)
BIC(arma405)
BIC(arma406)
BIC(arma407)
BIC(arma408)
BIC(arma409)
BIC(arma4010)
BIC(arma4011)
BIC(arma4012)
BIC(arma4013)
BIC(arma4014)

BIC(arma501)
BIC(arma502)
BIC(arma503)
BIC(arma504)
BIC(arma505)
BIC(arma506)
BIC(arma507)
BIC(arma508)
BIC(arma509)
BIC(arma5010)
BIC(arma5011)
BIC(arma5012)
BIC(arma5013)
BIC(arma5014)

BIC(arma601)
BIC(arma602)
BIC(arma603)
BIC(arma604)
BIC(arma605)
BIC(arma606)
BIC(arma607)
BIC(arma608)
BIC(arma609)
BIC(arma6010)
BIC(arma6011)
BIC(arma6012)
BIC(arma6013)
BIC(arma6014)

BIC(arma701)
BIC(arma702)
BIC(arma703)
BIC(arma704)
BIC(arma705)
BIC(arma706)
BIC(arma707)
BIC(arma708)
BIC(arma709)
BIC(arma7010)
BIC(arma7011)
BIC(arma7012)
BIC(arma7013)
BIC(arma7014)

BIC(arma801)
BIC(arma802)
BIC(arma803)
BIC(arma804)
BIC(arma805)
BIC(arma806)
BIC(arma807)
BIC(arma808)
BIC(arma809)
BIC(arma8010)
BIC(arma8011)
BIC(arma8012)
BIC(arma8013)
BIC(arma8014)

BIC(arma901)
BIC(arma902)
BIC(arma903)
BIC(arma904)
BIC(arma905)
BIC(arma906)
BIC(arma907)
BIC(arma908)
BIC(arma909)
BIC(arma9010)
BIC(arma9011)
BIC(arma9012)
BIC(arma9013)
BIC(arma9014)

BIC(arma1001)
BIC(arma1002)
BIC(arma1003)
BIC(arma1004)
BIC(arma1005)
BIC(arma1006)
BIC(arma1007)
BIC(arma1008)
BIC(arma1009)
BIC(arma10010)
BIC(arma10011)
BIC(arma10012)
BIC(arma10013)
BIC(arma10014)

BIC(arma1101)
BIC(arma1102)
BIC(arma1103)
BIC(arma1104)
BIC(arma1105)
BIC(arma1106)
BIC(arma1107)
BIC(arma1108)
BIC(arma1109)
BIC(arma11010)
BIC(arma11011)
BIC(arma11012)
BIC(arma11013)
BIC(arma11014)

BIC(arma1201)
BIC(arma1202)
BIC(arma1203)
BIC(arma1204)
BIC(arma1205)
BIC(arma1206)
BIC(arma1207)
BIC(arma1208)
BIC(arma1209)
BIC(arma12010)
BIC(arma12011)
BIC(arma12012)
BIC(arma12013)
BIC(arma12014)

BIC(arma1301)
BIC(arma1302)
BIC(arma1303)
BIC(arma1304)
BIC(arma1305)
BIC(arma1306)
BIC(arma1307)
BIC(arma1308)
BIC(arma1309)
BIC(arma13010)
BIC(arma13011)
BIC(arma13012)
BIC(arma13013)
BIC(arma13014)

BIC(arma1401)
BIC(arma1402)
BIC(arma1403)
BIC(arma1404)
BIC(arma1405)
BIC(arma1406)
BIC(arma1407)
BIC(arma1408)
BIC(arma1409)
BIC(arma14010)
BIC(arma14011)
BIC(arma14012)
BIC(arma14013)
BIC(arma14014)

## Pruebas AIC ====

AIC(ar1)
AIC(ar2)
AIC(ar3)
AIC(ar4)
AIC(ar5)
AIC(ar6)
AIC(ar7)
AIC(ar8)
AIC(ar9)
AIC(ar10)
AIC(ar11)
AIC(ar12)
AIC(ar13)
AIC(ar14)

AIC(ma1)
AIC(ma2)
AIC(ma3)
AIC(ma4)
AIC(ma5)
AIC(ma6)
AIC(ma7)
AIC(ma8)
AIC(ma9)
AIC(ma10)
AIC(ma11)
AIC(ma12)
AIC(ma13)
AIC(ma14)

AIC(arma101)
AIC(arma102)
AIC(arma103)
AIC(arma104)
AIC(arma105)
AIC(arma106)
AIC(arma107)
AIC(arma108)
AIC(arma109)
AIC(arma1010)
AIC(arma1011)
AIC(arma1012)
AIC(arma1013)
AIC(arma1014)

AIC(arma201)
AIC(arma202)
AIC(arma203)
AIC(arma204)
AIC(arma205)
AIC(arma206)
AIC(arma207)
AIC(arma208)
AIC(arma209)
AIC(arma2010)
AIC(arma2011)
AIC(arma2012)
AIC(arma2013)
AIC(arma2014)

AIC(arma301)
AIC(arma302)
AIC(arma303)
AIC(arma304)
AIC(arma305)
AIC(arma306)
AIC(arma307)
AIC(arma308)
AIC(arma309)
AIC(arma3010)
AIC(arma3011)
AIC(arma3012)
AIC(arma3013)
AIC(arma3014)

AIC(arma401)
AIC(arma402)
AIC(arma403)
AIC(arma404)
AIC(arma405)
AIC(arma406)
AIC(arma407)
AIC(arma408)
AIC(arma409)
AIC(arma4010)
AIC(arma4011)
AIC(arma4012)
AIC(arma4013)
AIC(arma4014)

AIC(arma501)
AIC(arma502)
AIC(arma503)
AIC(arma504)
AIC(arma505)
AIC(arma506)
AIC(arma507)
AIC(arma508)
AIC(arma509)
AIC(arma5010)
AIC(arma5011)
AIC(arma5012)
AIC(arma5013)
AIC(arma5014)

AIC(arma601)
AIC(arma602)
AIC(arma603)
AIC(arma604)
AIC(arma605)
AIC(arma606)
AIC(arma607)
AIC(arma608)
AIC(arma609)
AIC(arma6010)
AIC(arma6011)
AIC(arma6012)
AIC(arma6013)
AIC(arma6014)

AIC(arma701)
AIC(arma702)
AIC(arma703)
AIC(arma704)
AIC(arma705)
AIC(arma706)
AIC(arma707)
AIC(arma708)
AIC(arma709)
AIC(arma7010)
AIC(arma7011)
AIC(arma7012)
AIC(arma7013)
AIC(arma7014)

AIC(arma801)
AIC(arma802)
AIC(arma803)
AIC(arma804)
AIC(arma805)
AIC(arma806)
AIC(arma807)
AIC(arma808)
AIC(arma809)
AIC(arma8010)
AIC(arma8011)
AIC(arma8012)
AIC(arma8013)
AIC(arma8014)

AIC(arma901)
AIC(arma902)
AIC(arma903)
AIC(arma904)
AIC(arma905)
AIC(arma906)
AIC(arma907)
AIC(arma908)
AIC(arma909)
AIC(arma9010)
AIC(arma9011)
AIC(arma9012)
AIC(arma9013)
AIC(arma9014)

AIC(arma1001)
AIC(arma1002)
AIC(arma1003)
AIC(arma1004)
AIC(arma1005)
AIC(arma1006)
AIC(arma1007)
AIC(arma1008)
AIC(arma1009)
AIC(arma10010)
AIC(arma10011)
AIC(arma10012)
AIC(arma10013)
AIC(arma10014)

AIC(arma1101)
AIC(arma1102)
AIC(arma1103)
AIC(arma1104)
AIC(arma1105)
AIC(arma1106)
AIC(arma1107)
AIC(arma1108)
AIC(arma1109)
AIC(arma11010)
AIC(arma11011)
AIC(arma11012)
AIC(arma11013)
AIC(arma11014)

AIC(arma1201)
AIC(arma1202)
AIC(arma1203)
AIC(arma1204)
AIC(arma1205)
AIC(arma1206)
AIC(arma1207)
AIC(arma1208)
AIC(arma1209)
AIC(arma12010)
AIC(arma12011)
AIC(arma12012)
AIC(arma12013)
AIC(arma12014)

AIC(arma1301)
AIC(arma1302)
AIC(arma1303)
AIC(arma1304)
AIC(arma1305)
AIC(arma1306)
AIC(arma1307)
AIC(arma1308)
AIC(arma1309)
AIC(arma13010)
AIC(arma13011)
AIC(arma13012)
AIC(arma13013)
AIC(arma13014)

AIC(arma1401)
AIC(arma1402)
AIC(arma1403)
AIC(arma1404)
AIC(arma1405)
AIC(arma1406)
AIC(arma1407)
AIC(arma1408)
AIC(arma1409)
AIC(arma14010)
AIC(arma14011)
AIC(arma14012)
AIC(arma14013)
AIC(arma14014)

# Por  BIC gana el AR (1,0,0)

ar1 <- arima(resid_cuad, order = c(1,0,0))
ar1
coeftest(ar1)

# AR Roots ====
arroots <- function(object)
{
    if(!("Arima" %in% class(object)) &
       !("ar" %in% class(object)))
        stop("object must be of class Arima or ar")
    if("Arima" %in% class(object))
        parvec <- object$model$phi
    else
        parvec <- object$ar
    if(length(parvec) > 0)
    {
        last.nonzero <- max(which(abs(parvec) > 1e-08))
        if(last.nonzero > 0)
            return(structure(list(
                roots = polyroot(c(1, -parvec[1:last.nonzero])),
                type = "AR"),
                class = 'armaroots'))
    }
    return(structure(list(roots = numeric(0), type = "AR"),
                     class = 'armaroots'))
}    

# MA Roots ====
maroots <- function(object)
{
    if(!("Arima" %in% class(object)))
        stop("object must be of class Arima")
    parvec <- object$model$theta
    if(length(parvec) > 0)
    {
        last.nonzero <- max(which(abs(parvec) > 1e-08))
        if (last.nonzero > 0)
            return(structure(list(
                roots=polyroot(c(1,parvec[1:last.nonzero])),
                type="MA"),
                class='armaroots'))
    }
    return(structure(list(roots=numeric(0), type="MA"),
                     class='armaroots'))
}

plot.armaroots <- function(x, xlab="Real", ylab="Imaginary",
                           main=paste("Inverse roots of", x$type,
                                      "characteristic polynomial"),
                           ...)
{
    oldpar <- par(pty='s')
    on.exit(par(oldpar))
    plot(c(-1,1), c(-1,1), xlab=xlab, ylab=ylab,
         type="n", bty="n", xaxt="n", yaxt="n", main=main, ...)
    axis(1, at=c(-1,0,1), line=0.5, tck=-0.025)
    axis(2, at=c(-1,0,1), label=c("-i","0","i"),
         line=0.5, tck=-0.025)
    circx <- seq(-1,1,l=501)
    circy <- sqrt(1-circx^2)
    lines(c(circx,circx), c(circy,-circy), col='gray')
    lines(c(-2,2), c(0,0), col='gray')
    lines(c(0,0), c(-2,2), col='gray')
    if(length(x$roots) > 0)
    {
        inside <- abs(x$roots) > 1
        points(1/x$roots[inside], pch=19, col='black')
        if(sum(!inside) > 0)
            points(1/x$roots[!inside], pch=19, col='red')
    }
}

# Raíces del (1,0,0) ====
arroot <- arroots(ar1)
print(arroot)
iarroot <- arroot$roots^-1
print(iarroot)
plot.armaroots(arroot)

maroot <- maroots(ar1)
print(maroot)
imaroot <- maroot$roots^-1
print(imaroot)
plot.armaroots(maroot)

# Residuales (1,0,0) ====
resid_ar1 <- residuals(ar1)
plot.ts(resid_ar1)

acf(resid_ar1)
pacf(resid_ar1)
Box.test(resid_ar1, lag = length(resid_ar1)^.5, type = c("Box-Pierce"))
Box.test(resid_ar1,lag = length(resid_ar1)^.5, type = c("Ljung-Box"))

# Gráfico (1,0,0) ====
fitted_ar1 <- fitted.values(ar1)
ts.plot(resid_cuad, fitted_ar1, gpars = list(col = c("black", "blue")))

fitted_final <- fitted_ar1 + trend_cuad
fitted_final <- ts(fitted_final, start = c(1995,1), frequency = 12)
ts.plot(tdcts, fitted_final, gpars = list(col = c("black", "blue")))

# Pronóstico ====
pred_ar1 <- predict(ar1, n.ahead = 6)
pred_ar1
pred_ar1$pred
pred_ar1$se

## Pronóstico con tendencia ====
summary.lm(reg_cuad, robust = TRUE)
tiempo_pred <- c(157, 158, 159, 160, 161, 162)
tiempo_pred2 <- tiempo_pred^2
pred_tend <- 6.388e+00 +  6.302e-02*tiempo_pred + -2.164e-04*tiempo_pred2
pred_tend

pronostico <- pred_ar1$pred + pred_tend
pronostico
error <- tdcplot[157:162] - pronostico 
print(error)

# Intervalos de pronóstico ====
upper <- pronostico + 1.96*pred_ar1$se
print(upper)

lower <- pronostico - 1.96*pred_ar1$se
print(lower)

# Hacerlo serie de tiempo
pronos_ts <- ts(pronostico, start = c(2008,1), frequency = 12)
lower_ts <- ts(lower, start = c(2008,1), frequency = 12)
upper_ts <- ts(upper, start = c(2008,1), frequency = 12)

## Gráfico con intervalos ====
ts.plot(tdcts, pronos_ts, upper_ts, lower_ts, col = 1:4, xlim = c(1995, 2008),
        ylab = "Tipo de cambio", main = "Pronóstico de tipo de cambio para 2008") 

## Gráfico con intervalos y valores observados ====
ts.plot(tdcplotts, pronos_ts, upper_ts, lower_ts, col = 1:4, xlim = c(1995,2008),
        ylab = "Tipo de cambio", main = "Pronóstico y valores observados tipo de cambio 2008")


